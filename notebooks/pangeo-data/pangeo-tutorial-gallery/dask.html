
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dask Tutorial</title>
    
  <link rel="stylesheet" href="../../../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <link rel="shortcut icon" href="../../../_static/ProjectPythia_Logo_Final-01-Blue.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../index.html">
  
  <img src="../../../_static/ProjectPythia_Logo_Final-01-Blue.svg" class="logo" alt="logo">
  
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this site..." aria-label="Search this site..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../pages/about.html">
   About Project Pythia
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../pages/people.html">
   Project Pythia Team
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../pages/meetings.html">
   Meeting Schedule &amp; Notes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../pages/contributing.html">
   Contributor’s Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../pages/code_of_conduct.html">
   Code of Conduct
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../pages/discussion.html">
   Talk to us!
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../pages/links.html">
   Links to External Resources
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/notebooks/pangeo-data/pangeo-tutorial-gallery/dask.ipynb.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/NCAR/pythia-portal/master?urlpath=lab/tree/./notebooks/pangeo-data/pangeo-tutorial-gallery/dask.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com//github/NCAR/pythia-portal/blob/master/./notebooks/pangeo-data/pangeo-tutorial-gallery/dask.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dask-primer">
   Dask Primer
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dask-clusters">
   Dask Clusters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dask-dataframe">
   Dask Dataframe
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dask-arrays">
   Dask Arrays
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#a-bigger-calculation">
     A Bigger Calculation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reduction">
     Reduction
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dask-delayed">
   Dask Delayed
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-simple-functions">
   Create simple functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#annotate-functions-with-dask-delayed-to-make-them-lazy">
   Annotate functions with Dask Delayed to make them lazy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualize-computation">
   Visualize computation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-in-parallel">
   Run in parallel
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parallelize-normal-python-code">
   Parallelize Normal Python code
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="dask-tutorial">
<h1>Dask Tutorial<a class="headerlink" href="#dask-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="alert-info">
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>teaching:</strong> 20 minutes</p></li>
<li><p><strong>exercises:</strong> 0</p></li>
<li><p><strong>questions:</strong></p>
<ul>
<li><p>How does Dask parallelize computations in Python?</p></li>
</ul>
</li>
</ul>
</div></div>
<div class="section" id="table-of-contents">
<h2>Table of contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="#Dask-primer"><strong>Dask primer</strong></a></p></li>
<li><p><a class="reference external" href="#Dask-Clusters"><strong>Dask clusters</strong></a></p></li>
<li><p><a class="reference external" href="#Dask-Dataframe"><strong>Dask dataframe</strong></a></p></li>
<li><p><a class="reference external" href="#Dask-Arrays"><strong>Dask arrays</strong></a></p></li>
<li><p><a class="reference external" href="#Dask-Delayed"><strong>Dask delayed</strong></a></p></li>
</ol>
</div>
<div class="section" id="dask-primer">
<h2>Dask Primer<a class="headerlink" href="#dask-primer" title="Permalink to this headline">¶</a></h2>
<p><img src="http://dask.readthedocs.io/en/latest/_images/dask_horizontal.svg" 
     width="30%" 
     align=right
     alt="Dask logo"></p>
<p>Dask is a flexible parallel computing library for analytic computing. Dask provides dynamic parallel task scheduling and high-level big-data collections like <code class="docutils literal notranslate"><span class="pre">dask.array</span></code> and <code class="docutils literal notranslate"><span class="pre">dask.dataframe</span></code>. More on dask here: https://docs.dask.org/en/latest/</p>
<p><em>Note: Pieces of this notebook comes from the following sources:</em></p>
<ul class="simple">
<li><p>https://github.com/rabernat/research_computing</p></li>
<li><p>https://github.com/dask/dask-examples</p></li>
</ul>
</div>
<div class="section" id="dask-clusters">
<h2>Dask Clusters<a class="headerlink" href="#dask-clusters" title="Permalink to this headline">¶</a></h2>
<p>Dask needs a collection of computing resources in order to perform parallel computations. Dask Clusters have different names corresponding to different computing environments (for example, <a class="reference external" href="https://distributed.dask.org/en/latest/local-cluster.html">LocalCluster</a> for your Laptop, <a class="reference external" href="http://jobqueue.dask.org/">PBSCluster</a> for your HPC, or <a class="reference external" href="http://kubernetes.dask.org/">Kubernetes Cluster</a> for machines on the Cloud). Each cluster has a certain number of computing resources called ‘Workers’, that each get allocated CPU and RAM. The dask scheduling system maps jobs to each worker on a cluster for you, so the syntax is mostly the same once you initialize a cluster!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s start simple with a LocalCluster that makes use of all the cores and RAM we have on a single machine</span>
<span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">LocalCluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">LocalCluster</span><span class="p">()</span>
<span class="c1"># explicitly connect to the cluster we just created</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
<span class="n">client</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table style="border: 2px solid white;">
<tr>
<td style="vertical-align: top; border: 0px solid white">
<h3 style="text-align: left;">Client</h3>
<ul style="text-align: left; list-style: none; margin: 0; padding: 0;">
  <li><b>Scheduler: </b>tcp://127.0.0.1:39693</li>
  <li><b>Dashboard: </b><a href='/user/pangeo-data-pan-utorial-gallery-bigcobiw/proxy/8787/status' target='_blank'>/user/pangeo-data-pan-utorial-gallery-bigcobiw/proxy/8787/status</a></li>
</ul>
</td>
<td style="vertical-align: top; border: 0px solid white">
<h3 style="text-align: left;">Cluster</h3>
<ul style="text-align: left; list-style:none; margin: 0; padding: 0;">
  <li><b>Workers: </b>2</li>
  <li><b>Cores: </b>2</li>
  <li><b>Memory: </b>8.59 GB</li>
</ul>
</td>
</tr>
</table></div></div>
</div>
</div>
<div class="section" id="dask-dataframe">
<h2>Dask Dataframe<a class="headerlink" href="#dask-dataframe" title="Permalink to this headline">¶</a></h2>
<p>If you are working with a very large Pandas dataframe, you can consider parallizing computations by turning it into a Dask Dataframe. Dask Dataframes split a dataframe into partitions along an index. They support a large subset of the Pandas API. You can find additional details and examples here https://examples.dask.org/dataframe.html</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Although this is small csv file, we&#39;ll reuse our same example from before!</span>
<span class="c1"># Load csv results from server into a Pandas DataFrame</span>
<span class="kn">import</span> <span class="nn">dask.dataframe</span> <span class="k">as</span> <span class="nn">dd</span>

<span class="n">server</span> <span class="o">=</span> <span class="s1">&#39;https://webservices.volcano.si.edu/geoserver/GVP-VOTW/ows?&#39;</span>
<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;service=WFS&amp;version=2.0.0&amp;request=GetFeature&amp;typeName=GVP-VOTW:Smithsonian_VOTW_Holocene_Volcanoes&amp;outputFormat=csv&#39;</span>

<span class="c1"># blocksize=None means use a single partion</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">server</span> <span class="o">+</span> <span class="n">query</span><span class="p">,</span> <span class="n">blocksize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We only see the metadata, the actual data are only computed when requested.</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><strong>Dask DataFrame Structure:</strong></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FID</th>
      <th>Volcano_Number</th>
      <th>Volcano_Name</th>
      <th>Primary_Volcano_Type</th>
      <th>Last_Eruption_Year</th>
      <th>Country</th>
      <th>Geological_Summary</th>
      <th>Region</th>
      <th>Subregion</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Elevation</th>
      <th>Tectonic_Setting</th>
      <th>Geologic_Epoch</th>
      <th>Evidence_Category</th>
      <th>Primary_Photo_Link</th>
      <th>Primary_Photo_Caption</th>
      <th>Primary_Photo_Credit</th>
      <th>Major_Rock_Type</th>
      <th>GeoLocation</th>
    </tr>
    <tr>
      <th>npartitions=1</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th></th>
      <td>object</td>
      <td>int64</td>
      <td>object</td>
      <td>object</td>
      <td>float64</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>float64</td>
      <td>float64</td>
      <td>int64</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
  </tbody>
</table>
</div>
<div>Dask Name: from-delayed, 3 tasks</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can break up the table into 4 partions to map out to each core:</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">repartition</span><span class="p">(</span><span class="n">npartitions</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><strong>Dask DataFrame Structure:</strong></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FID</th>
      <th>Volcano_Number</th>
      <th>Volcano_Name</th>
      <th>Primary_Volcano_Type</th>
      <th>Last_Eruption_Year</th>
      <th>Country</th>
      <th>Geological_Summary</th>
      <th>Region</th>
      <th>Subregion</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th>Elevation</th>
      <th>Tectonic_Setting</th>
      <th>Geologic_Epoch</th>
      <th>Evidence_Category</th>
      <th>Primary_Photo_Link</th>
      <th>Primary_Photo_Caption</th>
      <th>Primary_Photo_Credit</th>
      <th>Major_Rock_Type</th>
      <th>GeoLocation</th>
    </tr>
    <tr>
      <th>npartitions=4</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th></th>
      <td>object</td>
      <td>int64</td>
      <td>object</td>
      <td>object</td>
      <td>float64</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>float64</td>
      <td>float64</td>
      <td>int64</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
      <td>object</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th></th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
  </tbody>
</table>
</div>
<div>Dask Name: repartition, 8 tasks</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s say we want to know the minimum last eruption year for all volcanoes</span>
<span class="n">last_eruption_year_min</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Last_Eruption_Year</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">last_eruption_year_min</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dd.Scalar&lt;series-..., dtype=float64&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instead of getting the actual value we see dd.Scalar, which represents a recipe for actually calculating this value</span>
<span class="n">last_eruption_year_min</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/dask_10_0.svg" src="../../../_images/dask_10_0.svg" /></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To get the value call the &#39;compute method&#39;</span>
<span class="c1"># NOTE: this was slower than using pandas directly,,, for small data you often don&#39;t need to use parallel computing!</span>
<span class="n">last_eruption_year_min</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-10450.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dask-arrays">
<h2>Dask Arrays<a class="headerlink" href="#dask-arrays" title="Permalink to this headline">¶</a></h2>
<p>A dask array looks and feels a lot like a numpy array.
However, a dask array doesn’t directly hold any data.
Instead, it symbolically represents the computations needed to generate the data.
Nothing is actually computed until the actual numerical values are needed.
This mode of operation is called “lazy”; it allows one to build up complex, large calculations symbolically before turning them over the scheduler for execution.</p>
<p>If we want to create a numpy array of all ones, we do it like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">)</span>
<span class="n">ones_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ones_np</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1., 1., 1., ..., 1., 1., 1.],
       [1., 1., 1., ..., 1., 1., 1.],
       [1., 1., 1., ..., 1., 1., 1.],
       ...,
       [1., 1., 1., ..., 1., 1., 1.],
       [1., 1., 1., ..., 1., 1., 1.],
       [1., 1., 1., ..., 1., 1., 1.]])
</pre></div>
</div>
</div>
</div>
<p>This array contains exactly 32 MB of data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1"> MB&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ones_np</span><span class="o">.</span><span class="n">nbytes</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>32.0 MB
</pre></div>
</div>
</div>
</div>
<p>Now let’s create the same array using dask’s array interface.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dask.array</span> <span class="k">as</span> <span class="nn">da</span>

<span class="n">ones</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ones</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 32.00 MB </td> <td> 32.00 MB </td></tr>
    <tr><th> Shape </th><td> (1000, 4000) </td> <td> (1000, 4000) </td></tr>
    <tr><th> Count </th><td> 1 Tasks </td><td> 1 Chunks </td></tr>
    <tr><th> Type </th><td> float64 </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="170" height="92" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="42" x2="120" y2="42" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="42" style="stroke-width:2" />
  <line x1="120" y1="0" x2="120" y2="42" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.000000,0.000000 120.000000,0.000000 120.000000,42.898796 0.000000,42.898796" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="62.898796" font-size="1.0rem" font-weight="100" text-anchor="middle" >4000</text>
  <text x="140.000000" y="21.449398" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,140.000000,21.449398)">1000</text>
</svg>
</td>
</tr>
</table></div></div>
</div>
<p>This works, but we didn’t tell dask how to split up the array, so it is not optimized for distributed computation.</p>
<p>A crucal difference with dask is that we must specify the <code class="docutils literal notranslate"><span class="pre">chunks</span></code> argument. “Chunks” describes how the array is split up over many sub-arrays.</p>
<p><img alt="Dask Arrays" src="http://dask.pydata.org/en/latest/_images/dask-array-black-text.svg" />
<em>source: <a class="reference external" href="http://dask.pydata.org/en/latest/array-overview.html">Dask Array Documentation</a></em></p>
<p>There are <a class="reference external" href="http://dask.pydata.org/en/latest/array-creation.html#chunks">several ways to specify chunks</a>.
In this lecture, we will use a block shape.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chunk_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">ones</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="n">chunk_shape</span><span class="p">)</span>
<span class="n">ones</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 32.00 MB </td> <td> 8.00 MB </td></tr>
    <tr><th> Shape </th><td> (1000, 4000) </td> <td> (1000, 1000) </td></tr>
    <tr><th> Count </th><td> 4 Tasks </td><td> 4 Chunks </td></tr>
    <tr><th> Type </th><td> float64 </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="170" height="92" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="42" x2="120" y2="42" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="42" style="stroke-width:2" />
  <line x1="30" y1="0" x2="30" y2="42" />
  <line x1="60" y1="0" x2="60" y2="42" />
  <line x1="90" y1="0" x2="90" y2="42" />
  <line x1="120" y1="0" x2="120" y2="42" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.000000,0.000000 120.000000,0.000000 120.000000,42.898796 0.000000,42.898796" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="62.898796" font-size="1.0rem" font-weight="100" text-anchor="middle" >4000</text>
  <text x="140.000000" y="21.449398" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,140.000000,21.449398)">1000</text>
</svg>
</td>
</tr>
</table></div></div>
</div>
<p>Notice that we just see a symbolic represetnation of the array, including its shape, dtype, and chunksize.
No data has been generated yet.
When we call <code class="docutils literal notranslate"><span class="pre">.compute()</span></code> on a dask array, the computation is trigger and the dask array becomes a numpy array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ones</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1., 1., 1., ..., 1., 1., 1.],
       [1., 1., 1., ..., 1., 1., 1.],
       [1., 1., 1., ..., 1., 1., 1.],
       ...,
       [1., 1., 1., ..., 1., 1., 1.],
       [1., 1., 1., ..., 1., 1., 1.],
       [1., 1., 1., ..., 1., 1., 1.]])
</pre></div>
</div>
</div>
</div>
<p>In order to understand what happened when we called <code class="docutils literal notranslate"><span class="pre">.compute()</span></code>, we can visualize the dask <em>graph</em>, the symbolic operations that make up the array</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ones</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/dask_23_0.svg" src="../../../_images/dask_23_0.svg" /></div>
</div>
<p>Our array has four chunks. To generate it, dask calls <code class="docutils literal notranslate"><span class="pre">np.ones</span></code> four times and then concatenates this together into one array.</p>
<p>Rather than immediately loading a dask array (which puts all the data into RAM), it is more common to reduce the data somehow. For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sum_of_ones</span> <span class="o">=</span> <span class="n">ones</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">sum_of_ones</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/dask_25_0.svg" src="../../../_images/dask_25_0.svg" /></div>
</div>
<p>Here we see dask’s strategy for finding the sum. This simple example illustrates the beauty of dask: it automatically designs an algorithm appropriate for custom operations with big data.</p>
<p>If we make our operation more complex, the graph gets more complex.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fancy_calculation</span> <span class="o">=</span> <span class="p">(</span><span class="n">ones</span> <span class="o">*</span> <span class="n">ones</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">fancy_calculation</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/dask_27_0.svg" src="../../../_images/dask_27_0.svg" /></div>
</div>
<div class="section" id="a-bigger-calculation">
<h3>A Bigger Calculation<a class="headerlink" href="#a-bigger-calculation" title="Permalink to this headline">¶</a></h3>
<p>The examples above were toy examples; the data (32 MB) is nowhere nearly big enough to warrant the use of dask.</p>
<p>We can make it a lot bigger!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bigshape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">200000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">)</span>
<span class="n">big_ones</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">bigshape</span><span class="p">,</span> <span class="n">chunks</span><span class="o">=</span><span class="n">chunk_shape</span><span class="p">)</span>
<span class="n">big_ones</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 6.40 GB </td> <td> 8.00 MB </td></tr>
    <tr><th> Shape </th><td> (200000, 4000) </td> <td> (1000, 1000) </td></tr>
    <tr><th> Count </th><td> 800 Tasks </td><td> 800 Chunks </td></tr>
    <tr><th> Type </th><td> float64 </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="79" height="170" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="29" y2="0" style="stroke-width:2" />
  <line x1="0" y1="0" x2="29" y2="0" />
  <line x1="0" y1="1" x2="29" y2="1" />
  <line x1="0" y1="1" x2="29" y2="1" />
  <line x1="0" y1="2" x2="29" y2="2" />
  <line x1="0" y1="3" x2="29" y2="3" />
  <line x1="0" y1="3" x2="29" y2="3" />
  <line x1="0" y1="4" x2="29" y2="4" />
  <line x1="0" y1="4" x2="29" y2="4" />
  <line x1="0" y1="5" x2="29" y2="5" />
  <line x1="0" y1="6" x2="29" y2="6" />
  <line x1="0" y1="6" x2="29" y2="6" />
  <line x1="0" y1="7" x2="29" y2="7" />
  <line x1="0" y1="7" x2="29" y2="7" />
  <line x1="0" y1="8" x2="29" y2="8" />
  <line x1="0" y1="9" x2="29" y2="9" />
  <line x1="0" y1="9" x2="29" y2="9" />
  <line x1="0" y1="10" x2="29" y2="10" />
  <line x1="0" y1="10" x2="29" y2="10" />
  <line x1="0" y1="11" x2="29" y2="11" />
  <line x1="0" y1="12" x2="29" y2="12" />
  <line x1="0" y1="12" x2="29" y2="12" />
  <line x1="0" y1="13" x2="29" y2="13" />
  <line x1="0" y1="13" x2="29" y2="13" />
  <line x1="0" y1="14" x2="29" y2="14" />
  <line x1="0" y1="15" x2="29" y2="15" />
  <line x1="0" y1="15" x2="29" y2="15" />
  <line x1="0" y1="16" x2="29" y2="16" />
  <line x1="0" y1="16" x2="29" y2="16" />
  <line x1="0" y1="17" x2="29" y2="17" />
  <line x1="0" y1="18" x2="29" y2="18" />
  <line x1="0" y1="18" x2="29" y2="18" />
  <line x1="0" y1="19" x2="29" y2="19" />
  <line x1="0" y1="19" x2="29" y2="19" />
  <line x1="0" y1="20" x2="29" y2="20" />
  <line x1="0" y1="21" x2="29" y2="21" />
  <line x1="0" y1="21" x2="29" y2="21" />
  <line x1="0" y1="22" x2="29" y2="22" />
  <line x1="0" y1="22" x2="29" y2="22" />
  <line x1="0" y1="23" x2="29" y2="23" />
  <line x1="0" y1="24" x2="29" y2="24" />
  <line x1="0" y1="24" x2="29" y2="24" />
  <line x1="0" y1="25" x2="29" y2="25" />
  <line x1="0" y1="25" x2="29" y2="25" />
  <line x1="0" y1="26" x2="29" y2="26" />
  <line x1="0" y1="27" x2="29" y2="27" />
  <line x1="0" y1="27" x2="29" y2="27" />
  <line x1="0" y1="28" x2="29" y2="28" />
  <line x1="0" y1="28" x2="29" y2="28" />
  <line x1="0" y1="29" x2="29" y2="29" />
  <line x1="0" y1="30" x2="29" y2="30" />
  <line x1="0" y1="30" x2="29" y2="30" />
  <line x1="0" y1="31" x2="29" y2="31" />
  <line x1="0" y1="31" x2="29" y2="31" />
  <line x1="0" y1="32" x2="29" y2="32" />
  <line x1="0" y1="33" x2="29" y2="33" />
  <line x1="0" y1="33" x2="29" y2="33" />
  <line x1="0" y1="34" x2="29" y2="34" />
  <line x1="0" y1="34" x2="29" y2="34" />
  <line x1="0" y1="35" x2="29" y2="35" />
  <line x1="0" y1="36" x2="29" y2="36" />
  <line x1="0" y1="36" x2="29" y2="36" />
  <line x1="0" y1="37" x2="29" y2="37" />
  <line x1="0" y1="37" x2="29" y2="37" />
  <line x1="0" y1="38" x2="29" y2="38" />
  <line x1="0" y1="39" x2="29" y2="39" />
  <line x1="0" y1="39" x2="29" y2="39" />
  <line x1="0" y1="40" x2="29" y2="40" />
  <line x1="0" y1="40" x2="29" y2="40" />
  <line x1="0" y1="41" x2="29" y2="41" />
  <line x1="0" y1="42" x2="29" y2="42" />
  <line x1="0" y1="42" x2="29" y2="42" />
  <line x1="0" y1="43" x2="29" y2="43" />
  <line x1="0" y1="43" x2="29" y2="43" />
  <line x1="0" y1="44" x2="29" y2="44" />
  <line x1="0" y1="45" x2="29" y2="45" />
  <line x1="0" y1="45" x2="29" y2="45" />
  <line x1="0" y1="46" x2="29" y2="46" />
  <line x1="0" y1="46" x2="29" y2="46" />
  <line x1="0" y1="47" x2="29" y2="47" />
  <line x1="0" y1="48" x2="29" y2="48" />
  <line x1="0" y1="48" x2="29" y2="48" />
  <line x1="0" y1="49" x2="29" y2="49" />
  <line x1="0" y1="49" x2="29" y2="49" />
  <line x1="0" y1="50" x2="29" y2="50" />
  <line x1="0" y1="51" x2="29" y2="51" />
  <line x1="0" y1="51" x2="29" y2="51" />
  <line x1="0" y1="52" x2="29" y2="52" />
  <line x1="0" y1="52" x2="29" y2="52" />
  <line x1="0" y1="53" x2="29" y2="53" />
  <line x1="0" y1="54" x2="29" y2="54" />
  <line x1="0" y1="54" x2="29" y2="54" />
  <line x1="0" y1="55" x2="29" y2="55" />
  <line x1="0" y1="55" x2="29" y2="55" />
  <line x1="0" y1="56" x2="29" y2="56" />
  <line x1="0" y1="57" x2="29" y2="57" />
  <line x1="0" y1="57" x2="29" y2="57" />
  <line x1="0" y1="58" x2="29" y2="58" />
  <line x1="0" y1="58" x2="29" y2="58" />
  <line x1="0" y1="59" x2="29" y2="59" />
  <line x1="0" y1="60" x2="29" y2="60" />
  <line x1="0" y1="60" x2="29" y2="60" />
  <line x1="0" y1="61" x2="29" y2="61" />
  <line x1="0" y1="61" x2="29" y2="61" />
  <line x1="0" y1="62" x2="29" y2="62" />
  <line x1="0" y1="63" x2="29" y2="63" />
  <line x1="0" y1="63" x2="29" y2="63" />
  <line x1="0" y1="64" x2="29" y2="64" />
  <line x1="0" y1="64" x2="29" y2="64" />
  <line x1="0" y1="65" x2="29" y2="65" />
  <line x1="0" y1="66" x2="29" y2="66" />
  <line x1="0" y1="66" x2="29" y2="66" />
  <line x1="0" y1="67" x2="29" y2="67" />
  <line x1="0" y1="67" x2="29" y2="67" />
  <line x1="0" y1="68" x2="29" y2="68" />
  <line x1="0" y1="69" x2="29" y2="69" />
  <line x1="0" y1="69" x2="29" y2="69" />
  <line x1="0" y1="70" x2="29" y2="70" />
  <line x1="0" y1="70" x2="29" y2="70" />
  <line x1="0" y1="71" x2="29" y2="71" />
  <line x1="0" y1="72" x2="29" y2="72" />
  <line x1="0" y1="72" x2="29" y2="72" />
  <line x1="0" y1="73" x2="29" y2="73" />
  <line x1="0" y1="73" x2="29" y2="73" />
  <line x1="0" y1="74" x2="29" y2="74" />
  <line x1="0" y1="75" x2="29" y2="75" />
  <line x1="0" y1="75" x2="29" y2="75" />
  <line x1="0" y1="76" x2="29" y2="76" />
  <line x1="0" y1="76" x2="29" y2="76" />
  <line x1="0" y1="77" x2="29" y2="77" />
  <line x1="0" y1="78" x2="29" y2="78" />
  <line x1="0" y1="78" x2="29" y2="78" />
  <line x1="0" y1="79" x2="29" y2="79" />
  <line x1="0" y1="79" x2="29" y2="79" />
  <line x1="0" y1="80" x2="29" y2="80" />
  <line x1="0" y1="81" x2="29" y2="81" />
  <line x1="0" y1="81" x2="29" y2="81" />
  <line x1="0" y1="82" x2="29" y2="82" />
  <line x1="0" y1="82" x2="29" y2="82" />
  <line x1="0" y1="83" x2="29" y2="83" />
  <line x1="0" y1="84" x2="29" y2="84" />
  <line x1="0" y1="84" x2="29" y2="84" />
  <line x1="0" y1="85" x2="29" y2="85" />
  <line x1="0" y1="85" x2="29" y2="85" />
  <line x1="0" y1="86" x2="29" y2="86" />
  <line x1="0" y1="87" x2="29" y2="87" />
  <line x1="0" y1="87" x2="29" y2="87" />
  <line x1="0" y1="88" x2="29" y2="88" />
  <line x1="0" y1="88" x2="29" y2="88" />
  <line x1="0" y1="89" x2="29" y2="89" />
  <line x1="0" y1="90" x2="29" y2="90" />
  <line x1="0" y1="90" x2="29" y2="90" />
  <line x1="0" y1="91" x2="29" y2="91" />
  <line x1="0" y1="91" x2="29" y2="91" />
  <line x1="0" y1="92" x2="29" y2="92" />
  <line x1="0" y1="93" x2="29" y2="93" />
  <line x1="0" y1="93" x2="29" y2="93" />
  <line x1="0" y1="94" x2="29" y2="94" />
  <line x1="0" y1="94" x2="29" y2="94" />
  <line x1="0" y1="95" x2="29" y2="95" />
  <line x1="0" y1="96" x2="29" y2="96" />
  <line x1="0" y1="96" x2="29" y2="96" />
  <line x1="0" y1="97" x2="29" y2="97" />
  <line x1="0" y1="97" x2="29" y2="97" />
  <line x1="0" y1="98" x2="29" y2="98" />
  <line x1="0" y1="99" x2="29" y2="99" />
  <line x1="0" y1="99" x2="29" y2="99" />
  <line x1="0" y1="100" x2="29" y2="100" />
  <line x1="0" y1="100" x2="29" y2="100" />
  <line x1="0" y1="101" x2="29" y2="101" />
  <line x1="0" y1="102" x2="29" y2="102" />
  <line x1="0" y1="102" x2="29" y2="102" />
  <line x1="0" y1="103" x2="29" y2="103" />
  <line x1="0" y1="103" x2="29" y2="103" />
  <line x1="0" y1="104" x2="29" y2="104" />
  <line x1="0" y1="105" x2="29" y2="105" />
  <line x1="0" y1="105" x2="29" y2="105" />
  <line x1="0" y1="106" x2="29" y2="106" />
  <line x1="0" y1="106" x2="29" y2="106" />
  <line x1="0" y1="107" x2="29" y2="107" />
  <line x1="0" y1="108" x2="29" y2="108" />
  <line x1="0" y1="108" x2="29" y2="108" />
  <line x1="0" y1="109" x2="29" y2="109" />
  <line x1="0" y1="109" x2="29" y2="109" />
  <line x1="0" y1="110" x2="29" y2="110" />
  <line x1="0" y1="111" x2="29" y2="111" />
  <line x1="0" y1="111" x2="29" y2="111" />
  <line x1="0" y1="112" x2="29" y2="112" />
  <line x1="0" y1="112" x2="29" y2="112" />
  <line x1="0" y1="113" x2="29" y2="113" />
  <line x1="0" y1="114" x2="29" y2="114" />
  <line x1="0" y1="114" x2="29" y2="114" />
  <line x1="0" y1="115" x2="29" y2="115" />
  <line x1="0" y1="115" x2="29" y2="115" />
  <line x1="0" y1="116" x2="29" y2="116" />
  <line x1="0" y1="117" x2="29" y2="117" />
  <line x1="0" y1="117" x2="29" y2="117" />
  <line x1="0" y1="118" x2="29" y2="118" />
  <line x1="0" y1="118" x2="29" y2="118" />
  <line x1="0" y1="119" x2="29" y2="119" />
  <line x1="0" y1="120" x2="29" y2="120" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="120" style="stroke-width:2" />
  <line x1="7" y1="0" x2="7" y2="120" />
  <line x1="14" y1="0" x2="14" y2="120" />
  <line x1="21" y1="0" x2="21" y2="120" />
  <line x1="29" y1="0" x2="29" y2="120" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.000000,0.000000 29.030629,0.000000 29.030629,120.000000 0.000000,120.000000" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="14.515315" y="140.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" >4000</text>
  <text x="49.030629" y="60.000000" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(-90,49.030629,60.000000)">200000</text>
</svg>
</td>
</tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1"> MB&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">big_ones</span><span class="o">.</span><span class="n">nbytes</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6400.0 MB
</pre></div>
</div>
</div>
</div>
<p>This dataset is 6.4 GB, rather than 32 MB! This is probably close to or greater than the amount of available RAM than you have in your computer. Nevertheless, dask has no problem working on it.</p>
<p><em>Do not try to <code class="docutils literal notranslate"><span class="pre">.visualize()</span></code> this array!</em></p>
<p>When doing a big calculation, dask also has some tools to help us understand what is happening under the hood. Let’s watch the dashboard again as we do a bigger computation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">big_calc</span> <span class="o">=</span> <span class="p">(</span><span class="n">big_ones</span> <span class="o">*</span> <span class="n">big_ones</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">big_calc</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="reduction">
<h3>Reduction<a class="headerlink" href="#reduction" title="Permalink to this headline">¶</a></h3>
<p>All the usual numpy methods work on dask arrays.
You can also apply numpy function directly to a dask array, and it will stay lazy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">big_ones_reduce</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">big_ones</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">big_ones_reduce</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table>
<tr>
<td>
<table>
  <thead>
    <tr><td> </td><th> Array </th><th> Chunk </th></tr>
  </thead>
  <tbody>
    <tr><th> Bytes </th><td> 1.60 MB </td> <td> 8.00 kB </td></tr>
    <tr><th> Shape </th><td> (200000,) </td> <td> (1000,) </td></tr>
    <tr><th> Count </th><td> 3400 Tasks </td><td> 200 Chunks </td></tr>
    <tr><th> Type </th><td> float64 </td><td> numpy.ndarray </td></tr>
  </tbody>
</table>
</td>
<td>
<svg width="170" height="75" style="stroke:rgb(0,0,0);stroke-width:1" >

  <!-- Horizontal lines -->
  <line x1="0" y1="0" x2="120" y2="0" style="stroke-width:2" />
  <line x1="0" y1="25" x2="120" y2="25" style="stroke-width:2" />

  <!-- Vertical lines -->
  <line x1="0" y1="0" x2="0" y2="25" style="stroke-width:2" />
  <line x1="0" y1="0" x2="0" y2="25" />
  <line x1="1" y1="0" x2="1" y2="25" />
  <line x1="1" y1="0" x2="1" y2="25" />
  <line x1="2" y1="0" x2="2" y2="25" />
  <line x1="3" y1="0" x2="3" y2="25" />
  <line x1="3" y1="0" x2="3" y2="25" />
  <line x1="4" y1="0" x2="4" y2="25" />
  <line x1="4" y1="0" x2="4" y2="25" />
  <line x1="5" y1="0" x2="5" y2="25" />
  <line x1="6" y1="0" x2="6" y2="25" />
  <line x1="6" y1="0" x2="6" y2="25" />
  <line x1="7" y1="0" x2="7" y2="25" />
  <line x1="7" y1="0" x2="7" y2="25" />
  <line x1="8" y1="0" x2="8" y2="25" />
  <line x1="9" y1="0" x2="9" y2="25" />
  <line x1="9" y1="0" x2="9" y2="25" />
  <line x1="10" y1="0" x2="10" y2="25" />
  <line x1="10" y1="0" x2="10" y2="25" />
  <line x1="11" y1="0" x2="11" y2="25" />
  <line x1="12" y1="0" x2="12" y2="25" />
  <line x1="12" y1="0" x2="12" y2="25" />
  <line x1="13" y1="0" x2="13" y2="25" />
  <line x1="13" y1="0" x2="13" y2="25" />
  <line x1="14" y1="0" x2="14" y2="25" />
  <line x1="15" y1="0" x2="15" y2="25" />
  <line x1="15" y1="0" x2="15" y2="25" />
  <line x1="16" y1="0" x2="16" y2="25" />
  <line x1="16" y1="0" x2="16" y2="25" />
  <line x1="17" y1="0" x2="17" y2="25" />
  <line x1="18" y1="0" x2="18" y2="25" />
  <line x1="18" y1="0" x2="18" y2="25" />
  <line x1="19" y1="0" x2="19" y2="25" />
  <line x1="19" y1="0" x2="19" y2="25" />
  <line x1="20" y1="0" x2="20" y2="25" />
  <line x1="21" y1="0" x2="21" y2="25" />
  <line x1="21" y1="0" x2="21" y2="25" />
  <line x1="22" y1="0" x2="22" y2="25" />
  <line x1="22" y1="0" x2="22" y2="25" />
  <line x1="23" y1="0" x2="23" y2="25" />
  <line x1="24" y1="0" x2="24" y2="25" />
  <line x1="24" y1="0" x2="24" y2="25" />
  <line x1="25" y1="0" x2="25" y2="25" />
  <line x1="25" y1="0" x2="25" y2="25" />
  <line x1="26" y1="0" x2="26" y2="25" />
  <line x1="27" y1="0" x2="27" y2="25" />
  <line x1="27" y1="0" x2="27" y2="25" />
  <line x1="28" y1="0" x2="28" y2="25" />
  <line x1="28" y1="0" x2="28" y2="25" />
  <line x1="29" y1="0" x2="29" y2="25" />
  <line x1="30" y1="0" x2="30" y2="25" />
  <line x1="30" y1="0" x2="30" y2="25" />
  <line x1="31" y1="0" x2="31" y2="25" />
  <line x1="31" y1="0" x2="31" y2="25" />
  <line x1="32" y1="0" x2="32" y2="25" />
  <line x1="33" y1="0" x2="33" y2="25" />
  <line x1="33" y1="0" x2="33" y2="25" />
  <line x1="34" y1="0" x2="34" y2="25" />
  <line x1="34" y1="0" x2="34" y2="25" />
  <line x1="35" y1="0" x2="35" y2="25" />
  <line x1="36" y1="0" x2="36" y2="25" />
  <line x1="36" y1="0" x2="36" y2="25" />
  <line x1="37" y1="0" x2="37" y2="25" />
  <line x1="37" y1="0" x2="37" y2="25" />
  <line x1="38" y1="0" x2="38" y2="25" />
  <line x1="39" y1="0" x2="39" y2="25" />
  <line x1="39" y1="0" x2="39" y2="25" />
  <line x1="40" y1="0" x2="40" y2="25" />
  <line x1="40" y1="0" x2="40" y2="25" />
  <line x1="41" y1="0" x2="41" y2="25" />
  <line x1="42" y1="0" x2="42" y2="25" />
  <line x1="42" y1="0" x2="42" y2="25" />
  <line x1="43" y1="0" x2="43" y2="25" />
  <line x1="43" y1="0" x2="43" y2="25" />
  <line x1="44" y1="0" x2="44" y2="25" />
  <line x1="45" y1="0" x2="45" y2="25" />
  <line x1="45" y1="0" x2="45" y2="25" />
  <line x1="46" y1="0" x2="46" y2="25" />
  <line x1="46" y1="0" x2="46" y2="25" />
  <line x1="47" y1="0" x2="47" y2="25" />
  <line x1="48" y1="0" x2="48" y2="25" />
  <line x1="48" y1="0" x2="48" y2="25" />
  <line x1="49" y1="0" x2="49" y2="25" />
  <line x1="49" y1="0" x2="49" y2="25" />
  <line x1="50" y1="0" x2="50" y2="25" />
  <line x1="51" y1="0" x2="51" y2="25" />
  <line x1="51" y1="0" x2="51" y2="25" />
  <line x1="52" y1="0" x2="52" y2="25" />
  <line x1="52" y1="0" x2="52" y2="25" />
  <line x1="53" y1="0" x2="53" y2="25" />
  <line x1="54" y1="0" x2="54" y2="25" />
  <line x1="54" y1="0" x2="54" y2="25" />
  <line x1="55" y1="0" x2="55" y2="25" />
  <line x1="55" y1="0" x2="55" y2="25" />
  <line x1="56" y1="0" x2="56" y2="25" />
  <line x1="57" y1="0" x2="57" y2="25" />
  <line x1="57" y1="0" x2="57" y2="25" />
  <line x1="58" y1="0" x2="58" y2="25" />
  <line x1="58" y1="0" x2="58" y2="25" />
  <line x1="59" y1="0" x2="59" y2="25" />
  <line x1="60" y1="0" x2="60" y2="25" />
  <line x1="60" y1="0" x2="60" y2="25" />
  <line x1="61" y1="0" x2="61" y2="25" />
  <line x1="61" y1="0" x2="61" y2="25" />
  <line x1="62" y1="0" x2="62" y2="25" />
  <line x1="63" y1="0" x2="63" y2="25" />
  <line x1="63" y1="0" x2="63" y2="25" />
  <line x1="64" y1="0" x2="64" y2="25" />
  <line x1="64" y1="0" x2="64" y2="25" />
  <line x1="65" y1="0" x2="65" y2="25" />
  <line x1="66" y1="0" x2="66" y2="25" />
  <line x1="66" y1="0" x2="66" y2="25" />
  <line x1="67" y1="0" x2="67" y2="25" />
  <line x1="67" y1="0" x2="67" y2="25" />
  <line x1="68" y1="0" x2="68" y2="25" />
  <line x1="69" y1="0" x2="69" y2="25" />
  <line x1="69" y1="0" x2="69" y2="25" />
  <line x1="70" y1="0" x2="70" y2="25" />
  <line x1="70" y1="0" x2="70" y2="25" />
  <line x1="71" y1="0" x2="71" y2="25" />
  <line x1="72" y1="0" x2="72" y2="25" />
  <line x1="72" y1="0" x2="72" y2="25" />
  <line x1="73" y1="0" x2="73" y2="25" />
  <line x1="73" y1="0" x2="73" y2="25" />
  <line x1="74" y1="0" x2="74" y2="25" />
  <line x1="75" y1="0" x2="75" y2="25" />
  <line x1="75" y1="0" x2="75" y2="25" />
  <line x1="76" y1="0" x2="76" y2="25" />
  <line x1="76" y1="0" x2="76" y2="25" />
  <line x1="77" y1="0" x2="77" y2="25" />
  <line x1="78" y1="0" x2="78" y2="25" />
  <line x1="78" y1="0" x2="78" y2="25" />
  <line x1="79" y1="0" x2="79" y2="25" />
  <line x1="79" y1="0" x2="79" y2="25" />
  <line x1="80" y1="0" x2="80" y2="25" />
  <line x1="81" y1="0" x2="81" y2="25" />
  <line x1="81" y1="0" x2="81" y2="25" />
  <line x1="82" y1="0" x2="82" y2="25" />
  <line x1="82" y1="0" x2="82" y2="25" />
  <line x1="83" y1="0" x2="83" y2="25" />
  <line x1="84" y1="0" x2="84" y2="25" />
  <line x1="84" y1="0" x2="84" y2="25" />
  <line x1="85" y1="0" x2="85" y2="25" />
  <line x1="85" y1="0" x2="85" y2="25" />
  <line x1="86" y1="0" x2="86" y2="25" />
  <line x1="87" y1="0" x2="87" y2="25" />
  <line x1="87" y1="0" x2="87" y2="25" />
  <line x1="88" y1="0" x2="88" y2="25" />
  <line x1="88" y1="0" x2="88" y2="25" />
  <line x1="89" y1="0" x2="89" y2="25" />
  <line x1="90" y1="0" x2="90" y2="25" />
  <line x1="90" y1="0" x2="90" y2="25" />
  <line x1="91" y1="0" x2="91" y2="25" />
  <line x1="91" y1="0" x2="91" y2="25" />
  <line x1="92" y1="0" x2="92" y2="25" />
  <line x1="93" y1="0" x2="93" y2="25" />
  <line x1="93" y1="0" x2="93" y2="25" />
  <line x1="94" y1="0" x2="94" y2="25" />
  <line x1="94" y1="0" x2="94" y2="25" />
  <line x1="95" y1="0" x2="95" y2="25" />
  <line x1="96" y1="0" x2="96" y2="25" />
  <line x1="96" y1="0" x2="96" y2="25" />
  <line x1="97" y1="0" x2="97" y2="25" />
  <line x1="97" y1="0" x2="97" y2="25" />
  <line x1="98" y1="0" x2="98" y2="25" />
  <line x1="99" y1="0" x2="99" y2="25" />
  <line x1="99" y1="0" x2="99" y2="25" />
  <line x1="100" y1="0" x2="100" y2="25" />
  <line x1="100" y1="0" x2="100" y2="25" />
  <line x1="101" y1="0" x2="101" y2="25" />
  <line x1="102" y1="0" x2="102" y2="25" />
  <line x1="102" y1="0" x2="102" y2="25" />
  <line x1="103" y1="0" x2="103" y2="25" />
  <line x1="103" y1="0" x2="103" y2="25" />
  <line x1="104" y1="0" x2="104" y2="25" />
  <line x1="105" y1="0" x2="105" y2="25" />
  <line x1="105" y1="0" x2="105" y2="25" />
  <line x1="106" y1="0" x2="106" y2="25" />
  <line x1="106" y1="0" x2="106" y2="25" />
  <line x1="107" y1="0" x2="107" y2="25" />
  <line x1="108" y1="0" x2="108" y2="25" />
  <line x1="108" y1="0" x2="108" y2="25" />
  <line x1="109" y1="0" x2="109" y2="25" />
  <line x1="109" y1="0" x2="109" y2="25" />
  <line x1="110" y1="0" x2="110" y2="25" />
  <line x1="111" y1="0" x2="111" y2="25" />
  <line x1="111" y1="0" x2="111" y2="25" />
  <line x1="112" y1="0" x2="112" y2="25" />
  <line x1="112" y1="0" x2="112" y2="25" />
  <line x1="113" y1="0" x2="113" y2="25" />
  <line x1="114" y1="0" x2="114" y2="25" />
  <line x1="114" y1="0" x2="114" y2="25" />
  <line x1="115" y1="0" x2="115" y2="25" />
  <line x1="115" y1="0" x2="115" y2="25" />
  <line x1="116" y1="0" x2="116" y2="25" />
  <line x1="117" y1="0" x2="117" y2="25" />
  <line x1="117" y1="0" x2="117" y2="25" />
  <line x1="118" y1="0" x2="118" y2="25" />
  <line x1="118" y1="0" x2="118" y2="25" />
  <line x1="119" y1="0" x2="119" y2="25" />
  <line x1="120" y1="0" x2="120" y2="25" style="stroke-width:2" />

  <!-- Colored Rectangle -->
  <polygon points="0.000000,0.000000 120.000000,0.000000 120.000000,25.412617 0.000000,25.412617" style="fill:#ECB172A0;stroke-width:0"/>

  <!-- Text -->
  <text x="60.000000" y="45.412617" font-size="1.0rem" font-weight="100" text-anchor="middle" >200000</text>
  <text x="140.000000" y="12.706308" font-size="1.0rem" font-weight="100" text-anchor="middle" transform="rotate(0,140.000000,12.706308)">1</text>
</svg>
</td>
</tr>
</table></div></div>
</div>
<p>Plotting also triggers computation, since we need the actual values</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">big_ones_reduce</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fa8fcb83a90&gt;]
</pre></div>
</div>
<img alt="../../../_images/dask_37_1.png" src="../../../_images/dask_37_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="dask-delayed">
<h2>Dask Delayed<a class="headerlink" href="#dask-delayed" title="Permalink to this headline">¶</a></h2>
<p>Dask.delayed is a simple and powerful way to parallelize existing code.  It allows users to delay function calls into a task graph with dependencies.  Dask.delayed doesn’t provide any fancy parallel algorithms like Dask.dataframe, but it does give the user complete control over what they want to build.</p>
<p>Systems like Dask.dataframe are built with Dask.delayed.  If you have a problem that is paralellizable, but isn’t as simple as just a big array or a big dataframe, then dask.delayed may be the right choice for you.</p>
</div>
<div class="section" id="create-simple-functions">
<h2>Create simple functions<a class="headerlink" href="#create-simple-functions" title="Permalink to this headline">¶</a></h2>
<p>These functions do simple operations like add two numbers together, but they sleep for a random amount of time to simulate real work.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>


<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">dec</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<p>We can run them like normal Python functions below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">inc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 10.4 ms, sys: 4.44 ms, total: 14.8 ms
Wall time: 401 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3
</pre></div>
</div>
</div>
</div>
<p>These ran one after the other, in sequence.  Note though that the first two lines <code class="docutils literal notranslate"><span class="pre">inc(1)</span></code> and <code class="docutils literal notranslate"><span class="pre">dec(2)</span></code> don’t depend on each other, we <em>could</em> have called them in parallel had we been clever.</p>
</div>
<div class="section" id="annotate-functions-with-dask-delayed-to-make-them-lazy">
<h2>Annotate functions with Dask Delayed to make them lazy<a class="headerlink" href="#annotate-functions-with-dask-delayed-to-make-them-lazy" title="Permalink to this headline">¶</a></h2>
<p>We can call <code class="docutils literal notranslate"><span class="pre">dask.delayed</span></code> on our funtions to make them lazy.  Rather than compute their results immediately, they record what we want to compute as a task into a graph that we’ll run later on parallel hardware.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dask</span>

<span class="n">inc</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
<span class="n">dec</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
<span class="n">add</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Calling these lazy functions is now almost free.  We’re just constructing a graph</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">inc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">z</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 0 ns, sys: 1.66 ms, total: 1.66 ms
Wall time: 1.31 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Delayed(&#39;add-b78ba450-388a-4e31-88d4-222b99b691b6&#39;)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualize-computation">
<h2>Visualize computation<a class="headerlink" href="#visualize-computation" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">rankdir</span><span class="o">=</span><span class="s1">&#39;LR&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/dask_47_0.svg" src="../../../_images/dask_47_0.svg" /></div>
</div>
</div>
<div class="section" id="run-in-parallel">
<h2>Run in parallel<a class="headerlink" href="#run-in-parallel" title="Permalink to this headline">¶</a></h2>
<p>Call <code class="docutils literal notranslate"><span class="pre">.compute()</span></code> when you want your result as a normal Python object</p>
<p>If you started <code class="docutils literal notranslate"><span class="pre">Client()</span></code> above then you may want to watch the status page during computation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">z</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 32.9 ms, sys: 5.39 ms, total: 38.3 ms
Wall time: 334 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="parallelize-normal-python-code">
<h2>Parallelize Normal Python code<a class="headerlink" href="#parallelize-normal-python-code" title="Permalink to this headline">¶</a></h2>
<p>Now we use Dask in normal for-loopy Python code.  This generates graphs instead of doing computations directly, but still looks like the code we had before.  Dask is a convenient way to add parallelism to existing workflows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">zs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">inc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">zs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

<span class="n">zs</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">persist</span><span class="p">(</span><span class="o">*</span><span class="n">zs</span><span class="p">)</span>  <span class="c1"># trigger computation in the background</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 196 ms, sys: 54.4 ms, total: 251 ms
Wall time: 245 ms
</pre></div>
</div>
</div>
</div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Project Pythia Developers & Contributors<br/>
        
            &copy; Copyright 2020-2021.<br/>
          Last updated on Jan 14, 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>